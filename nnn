# Obliczanie podstawowych statystyk
mean_value <- mean(simulations_data)
median_value <- median(simulations_data)
variance_value <- var(simulations_data)
sd_value <- sd(simulations_data)

# Obliczanie kwantyli
quantile_90 <- quantile(simulations_data, 0.9)
quantile_95 <- quantile(simulations_data, 0.95)
quantile_995 <- quantile(simulations_data, 0.995)

# Tabela wyników
stats_table <- data.frame(
  "Mean" = mean_value,
  "Median" = median_value,
  "Variance" = variance_value,
  "Standard Deviation" = sd_value,
  "90th Percentile" = quantile_90,
  "95th Percentile" = quantile_95,
  "99.5th Percentile" = quantile_995
)

# Wyświetlenie tabeli
print(stats_table)


# Funkcja bootstrapowa do obliczenia przedziałów ufności dla różnych statystyk
bootstrap_ci <- function(data, num_samples, statistic, ci_percentile = 95) {
  bootstrap_samples <- replicate(num_samples, sample(data, length(data), replace = TRUE))
  statistics <- apply(bootstrap_samples, 2, statistic)
  
  lower_percentile <- (100 - ci_percentile) / 2
  upper_percentile <- 100 - lower_percentile
  
  ci_lower <- quantile(statistics, lower_percentile / 100)
  ci_upper <- quantile(statistics, upper_percentile / 100)
  
  return(list(statistics = statistics, ci_lower = ci_lower, ci_upper = ci_upper))
}

# Przeprowadzenie bootstrapu dla różnych statystyk
num_samples <- 1000
bootstrap_mean <- bootstrap_ci(simulations_data, num_samples, mean)
bootstrap_median <- bootstrap_ci(simulations_data, num_samples, median)
bootstrap_quantile_90 <- bootstrap_ci(simulations_data, num_samples, function(x) quantile(x, 0.9))
bootstrap_quantile_95 <- bootstrap_ci(simulations_data, num_samples, function(x) quantile(x, 0.95))
bootstrap_quantile_995 <- bootstrap_ci(simulations_data, num_samples, function(x) quantile(x, 0.995))

# Tabela wyników przedziałów ufności
ci_table <- data.frame(
  "Statistic" = c("Mean", "Median", "90th Percentile", "95th Percentile", "99.5th Percentile"),
  "CI Lower" = c(bootstrap_mean$ci_lower, bootstrap_median$ci_lower, bootstrap_quantile_90$ci_lower,
                 bootstrap_quantile_95$ci_lower, bootstrap_quantile_995$ci_lower),
  "CI Upper" = c(bootstrap_mean$ci_upper, bootstrap_median$ci_upper, bootstrap_quantile_90$ci_upper,
                 bootstrap_quantile_95$ci_upper, bootstrap_quantile_995$ci_upper)
)

# Wyświetlenie tabeli przedziałów ufności
print(ci_table)


# Rysowanie histogramu
par(mfrow=c(1,2))  # Dwa wykresy obok siebie

# Wykres 1: Rozkład danych
hist(simulations_data, breaks = 30, col = 'skyblue', border = 'black', 
     main = 'Rozkład wyników symulacji', xlab = 'Wyniki', ylab = 'Częstość')

# Wykres 2: Bootstrap dla średniej
hist(bootstrap_mean$statistics, breaks = 30, col = 'lightgreen', border = 'black', 
     main = 'Bootstrap dla średniej', xlab = 'Średnia z próbek', ylab = 'Częstość')
abline(v = mean(simulations_data), col = 'red', lwd = 2, lty = 2)

# Zapisanie wyników
write.csv(stats_table, "statystyki.csv")
write.csv(ci_table, "przedzialy_ufnosci.csv")
