# Funkcja do obliczania stabilności statystyk (średnia, wariancja, odchylenie standardowe)
calculate_stability <- function(data, num_samples) {
  # Inicjalizacja wektorów do przechowywania wyników
  means <- numeric(num_samples)
  variances <- numeric(num_samples)
  sds <- numeric(num_samples)
  
  # Losowanie prób bez powtórzeń i obliczanie statystyk
  for (i in 1:num_samples) {
    sample_data <- sample(data, length(data), replace = FALSE)  # Losowanie bez powtórzeń
    means[i] <- mean(sample_data)
    variances[i] <- var(sample_data)
    sds[i] <- sd(sample_data)
  }
  
  # Obliczanie przedziałów ufności (np. 95%)
  ci_mean <- quantile(means, c(0.025, 0.975))
  ci_variance <- quantile(variances, c(0.025, 0.975))
  ci_sd <- quantile(sds, c(0.025, 0.975))
  
  # Zwracanie wyników
  return(list(mean = means, variance = variances, sd = sds, 
              ci_mean = ci_mean, ci_variance = ci_variance, ci_sd = ci_sd))
}

# Przykład dla danych simulations_data
num_samples <- 1000
stability_results <- calculate_stability(simulations_data, num_samples)

# Wyświetlenie wyników
cat("Przedziały ufności dla średniej: ", stability_results$ci_mean, "\n")
cat("Przedziały ufności dla wariancji: ", stability_results$ci_variance, "\n")
cat("Przedziały ufności dla odchylenia standardowego: ", stability_results$ci_sd, "\n")

# Rysowanie wykresów
par(mfrow = c(1, 3))  # Trzy wykresy obok siebie

# Wykres dla średniej
hist(stability_results$mean, col = "lightblue", main = "Rozkład średnich", xlab = "Średnia", ylab = "Częstość")
abline(v = mean(simulations_data), col = "red", lwd = 2)

# Wykres dla wariancji
hist(stability_results$variance, col = "lightgreen", main = "Rozkład wariancji", xlab = "Wariancja", ylab = "Częstość")
abline(v = var(simulations_data), col = "red", lwd = 2)

# Wykres dla odchylenia standardowego
hist(stability_results$sd, col = "lightcoral", main = "Rozkład odchylenia standardowego", xlab = "Odchylenie standardowe", ylab = "Częstość")
abline(v = sd(simulations_data), col = "red", lwd = 2)
