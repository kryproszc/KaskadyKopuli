library(foreach)
library(doParallel)

# Ustawienie liczby wątków na ilość rdzeni procesora
numCores <- detectCores() - 1
cl <- makeCluster(numCores)
registerDoParallel(cl)

# Zrównoleglenie pętli
wiener_surowe_copy <- foreach(i = 1:dim(wiener_geokodowane)[1], .combine = rbind) %dopar% {
  umowa_przed <- umowy_przed_geokodowane[i]
  ind_zmiany <- which(umowy_po_surowe == umowa_przed)

  wiener_surowe_copy[ind_zmiany, 14] <- wiener_geokodowane[i, 13]
  wiener_surowe_copy[ind_zmiany, 15] <- wiener_geokodowane[i, 14]
  wiener_surowe_copy[ind_zmiany, 16] <- wiener_geokodowane[i, 15]
  wiener_surowe_copy[ind_zmiany, 17] <- wiener_geokodowane[i, 16]
  wiener_surowe_copy[ind_zmiany, 18] <- wiener_geokodowane[i, 17]
}

# Zakończenie klastra
stopCluster(cl)

head(wiener_surowe_copy[300000, ])
