library(openxlsx)

# Przykładowe dane dla `suma_ubezpieczen` (losowe wartości dla ubezpieczycieli)
suma_ubezpieczen <- list(
  "14" = sample(50:300, 100, replace = TRUE),
  "15" = sample(30:150, 80, replace = TRUE),
  "16" = sample(10:200, 120, replace = TRUE)
)

# Tworzymy nowy plik Excel z obiektem `workbook`
wb <- createWorkbook()

# Przechodzimy przez każdego `ubezpieczyciela` w `suma_ubezpieczen`
for (ubezpieczyciel in names(suma_ubezpieczen)) {
  # Pobieramy wartości dla bieżącego `ubezpieczyciela`
  wartosci <- suma_ubezpieczen[[ubezpieczyciel]]
  
  # Tworzymy nowy arkusz z nazwą równą numerowi ubezpieczyciela
  addWorksheet(wb, sheetName = ubezpieczyciel)
  
  # Obliczamy kwantyle od 0 do 1 co 0.01
  kwantyle <- quantile(wartosci, probs = seq(0, 1, by = 0.01))
  
  # Konwertujemy kwantyle na ramkę danych, aby móc zapisać ją w arkuszu Excela
  tabela_kwantyli <- data.frame(Percentyl = seq(0, 1, by = 0.01), Kwantyl = kwantyle)
  
  # Zapisujemy tabelę kwantyli w arkuszu Excela, zaczynając od komórki A1
  writeData(wb, sheet = ubezpieczyciel, tabela_kwantyli, startRow = 1, startCol = 1)
}

# Zapisujemy workbook do pliku Excel
saveWorkbook(wb, "suma_ubezpieczen_kwantyle.xlsx", overwrite = TRUE)

# Komunikat o zakończeniu
print("Plik Excel 'suma_ubezpieczen_kwantyle.xlsx' został zapisany.")
