# Wczytanie potrzebnych pakietów
library(openxlsx)
library(ggplot2)

# Ustalanie katalogów zapisu
# Katalog tymczasowy na plik PNG
save_dir <- tempdir()

# Katalog docelowy dla pliku Excel (zmień na odpowiednią ścieżkę, np. "Documents")
excel_dir <- "C:/Users/TwojaNazwaUzytkownika/Documents"

# Przykładowe dane do wykresu
percentyle <- c(0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 0.95, 0.97, 0.99, 0.995)
wartosci_bez_zer <- sample(10:200, 100, replace = TRUE)
kwantyle <- quantile(wartosci_bez_zer, probs = percentyle)
tabela_kwantyli <- data.frame(Percentyl = percentyle, Kwantyl = kwantyle)

# Tworzenie wykresu
p <- ggplot(tabela_kwantyli, aes(x = Percentyl, y = Kwantyl)) +
  geom_line(color = "darkblue", size = 1.2) +
  geom_point(color = "red", size = 3) +
  ggtitle("Wykres kwantyli") +
  xlab("Percentyl") +
  ylab("Kwantyl") +
  theme_minimal(base_size = 14)

# Zapisujemy jako plik PNG w `save_dir`
png_file <- file.path(save_dir, "kwantyle_16.png")
ggsave(png_file, plot = p, width = 8, height = 6, dpi = 300)
message("Plik PNG zapisany jako: ", png_file)

# Tworzenie i zapis pliku Excel
if (file.exists(png_file)) {
  wb <- createWorkbook()
  addWorksheet(wb, "Wykres")
  insertImage(wb, sheet = "Wykres", file = png_file, width = 6, height = 4, startRow = 1, startCol = 1, units = "in")
  
  # Zapisujemy workbook do pliku Excel w `excel_dir`
  excel_file <- file.path(excel_dir, "wykresy_kwantyli.xlsx")
  saveWorkbook(wb, excel_file, overwrite = TRUE)
  print(paste("Plik Excel zapisany jako:", excel_file))
} else {
  stop("Plik obrazu nie został znaleziony.")
}
